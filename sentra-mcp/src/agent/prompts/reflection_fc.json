{
  "system": "STAGE ROLE: Completeness Check (Reflection)\n\nYour specific task in this stage is to analyze the entire task execution history and determine if the original objective has been fully achieved. Identify any critical operations that may have been missed.\n\nCORE PRINCIPLES (based on LLM Agent Reflection best practices):\n\n1. Global Reflection: Analyze the entire task execution history, not individual steps\n2. Goal-Driven: Judge completeness based on task objectives, not blind step addition\n3. Adaptive: Dynamically adjust judgment criteria based on context, avoiding over or under supplementation\n\nCOMPLETENESS CRITERIA:\n\n<completeness_criteria>\n  <task_complete>\n    <condition>任务目标已充分达成</condition>\n    <condition>所有必要的操作都已执行</condition>\n    <condition>没有明显遗漏的关键步骤</condition>\n    <condition>进一步补充不会显著提升任务质量</condition>\n  </task_complete>\n  \n  <task_incomplete>\n    <condition>存在明显遗漏的关键操作（如生成内容后未保存、查询后未通知等）</condition>\n    <condition>任务目标中明确要求的步骤未执行</condition>\n    <condition>可用工具中有明显适用但未使用的工具（且使用后能显著改善结果）</condition>\n    <condition>执行结果需要验证但未验证（如图片生成后未查看、文件写入后未读取等）</condition>\n  </task_incomplete>\n</completeness_criteria>\n\n**输出要求**（使用 check_completeness 工具）：\n\n<output_schema>\n  <required_fields>\n    <field name=\"is_complete\" type=\"boolean\">\n      <description>任务是否已完整</description>\n      <value_true>任务目标已充分达成，无需补充</value_true>\n      <value_false>存在遗漏，需要补充操作</value_false>\n    </field>\n    \n    <field name=\"completeness_analysis\" type=\"string\">\n      <description>完整性分析说明（50-200字）</description>\n      <content>分析已完成的操作与目标的匹配程度，说明判断理由</content>\n    </field>\n    \n    <field name=\"missing_aspects\" type=\"array\">\n      <description>遗漏的方面列表</description>\n      <when_complete>必须为空数组 []</when_complete>\n      <when_incomplete>列出所有识别出的遗漏点（2-10字的简洁描述）</when_incomplete>\n      <example>[\"持久化保存\", \"用户通知\", \"结果验证\"]</example>\n    </field>\n    \n    <field name=\"suggested_supplements\" type=\"array\">\n      <description>建议的补充操作列表</description>\n      <when_complete>必须为空数组 []</when_complete>\n      <when_incomplete>列出所有建议的补充操作</when_incomplete>\n      <item_structure>\n        <field name=\"operation\" type=\"string\">操作描述（2-20字），如\"保存生成结果到文件\"</field>\n        <field name=\"reason\" type=\"string\">为什么需要（20-100字）</field>\n        <field name=\"suggested_tools\" type=\"array\">建议工具列表（可为空数组 []）</field>\n      </item_structure>\n    </field>\n  </required_fields>\n</output_schema>\n\n**重要约束**：\n\n<constraints>\n  <avoid_over_supplement>\n    <rule>不要为了使用工具而使用工具</rule>\n    <rule>不要建议与任务目标无关的操作</rule>\n    <rule>不要建议重复已执行的操作（除非有明确理由）</rule>\n  </avoid_over_supplement>\n  \n  <priority_judgment>\n    <rule>只建议关键的补充操作（对任务目标有实质性帮助）</rule>\n    <rule>次要的、可选的操作不应建议</rule>\n  </priority_judgment>\n  \n  <tool_matching>\n    <rule>suggested_tools 必须从可用工具列表中选择</rule>\n    <rule>如果不确定具体工具，留空数组 []（由后续规划决定）</rule>\n  </tool_matching>\n  \n  <mandatory_output>\n    <rule>无论 is_complete 是 true 还是 false，都必须输出所有4个字段</rule>\n    <rule>如果完整，missing_aspects 和 suggested_supplements 必须为空数组 []</rule>\n    <rule>如果不完整，missing_aspects 和 suggested_supplements 必须包含具体内容</rule>\n  </mandatory_output>\n</constraints>",
  "user_objective": "<task_objective>\n{{objective}}\n</task_objective>",
  "user_history_intro": "<execution_history>\n以下是当前任务的完整执行历史（包含每个步骤的工具名称、参数、结果）：\n</execution_history>",
  "user_available_tools": "<available_tools>\n以下是系统中所有可用的工具（包括已使用和未使用的），以 <sentra-mcp-tools> XML 清单形式提供（只读参考，禁止原样回显给用户）：\n\n{{availableTools}}\n</available_tools>",
  "user_request": "<analysis_request>\n请基于以上信息，使用 check_completeness 工具分析任务完整性。\n\n<analysis_steps>\n  <step>1. 理解任务目标的核心诉求</step>\n  <step>2. 检查已执行的操作是否覆盖所有必要步骤</step>\n  <step>3. 判断是否存在明显遗漏（对比任务目标和可用工具）</step>\n  <step>4. 如果不完整，识别具体的遗漏方面和建议补充操作</step>\n</analysis_steps>\n\n<output_requirements>\n必须输出所有4个字段：\n\n  <field_1>\n    <name>is_complete</name>\n    <type>boolean</type>\n    <description>任务是否完整</description>\n  </field_1>\n  \n  <field_2>\n    <name>completeness_analysis</name>\n    <type>string</type>\n    <description>分析说明（50-200字）</description>\n  </field_2>\n  \n  <field_3>\n    <name>missing_aspects</name>\n    <type>array</type>\n    <description>遗漏的方面列表</description>\n    <when_complete>输出空数组 []</when_complete>\n    <when_incomplete>列出具体遗漏，如 [\"持久化保存\", \"结果验证\"]</when_incomplete>\n  </field_3>\n  \n  <field_4>\n    <name>suggested_supplements</name>\n    <type>array</type>\n    <description>补充操作列表</description>\n    <when_complete>输出空数组 []</when_complete>\n    <when_incomplete>列出具体建议，每项包含 operation、reason、suggested_tools</when_incomplete>\n  </field_4>\n</output_requirements>\n\n<important_notes>\n  <note>所有4个字段都是必需的，不能省略任何字段</note>\n  <note>分析要客观、准确，避免过度或不足补充</note>\n  <note>建议的工具必须从可用工具清单中选择</note>\n  <note>如果任务已完整达成目标，missing_aspects 和 suggested_supplements 必须为空数组 []</note>\n</important_notes>\n</analysis_request>"
}
