# ============================================
# Sentra Agent 测试环境配置示例
# ============================================
# 使用方法：复制此文件为 .env 并修改相应参数
# ============================================

# -------------------- WebSocket 连接配置 --------------------
# WebSocket 服务器地址
WS_URL=ws://localhost:6702
# 超时时间（毫秒）
WS_TIMEOUT=60000
# 重连延迟（毫秒）
WS_RECONNECT_DELAY=5000

# -------------------- AI API 配置 --------------------
# API 基础 URL
API_BASE_URL=https://yuanplus.cloud/v1
# API 密钥（必须配置）
API_KEY=your-api-key-here
# 使用的模型名称
MODEL_NAME=gemini-2.5-pro
# 温度参数（0-1，越高越随机）
TEMPERATURE=0.7
# 最大 token 数（设为 -1 表示不限制）
MAX_TOKENS=-1
# 最大重试次数
MAX_RETRIES=3
# 请求超时时间（毫秒）
TIMEOUT=60000

# -------------------- 消息解析配置 --------------------
# 段落分隔符（用于拆分AI回复的多个段落）
# 默认使用单竖线 |
# 可以改为其他符号，如：|| 或 ###
PARAGRAPH_SEPARATOR=|

# 文件占位符正则模式（一般不需要修改）
FILE_PLACEHOLDER_PATTERN=__FILE_(\d+)__

# 连续换行分割阈值（连续几个换行符会触发段落分割）
NEWLINE_SPLIT_THRESHOLD=2

# -------------------- 消息发送策略配置 --------------------
# 群聊@用户的概率（0-1）
# 0 = 从不@，1 = 总是@，0.25 = 25%概率@
GROUP_AT_PROBABILITY=0.25

# 多片段时首条回复概率（0-1）
MULTI_SEGMENT_REPLY_PROBABILITY=0.6

# 单片段时回复概率（0-1）
SINGLE_SEGMENT_REPLY_PROBABILITY=0.5

# 优先引用用户消息的概率（vs机器人消息，0-1）
PREFER_USER_MESSAGE_PROBABILITY=0.7

# -------------------- 发送间隔配置 --------------------
# 片段间最小延迟（毫秒）- 模拟真实打字速度
SEGMENT_DELAY_MIN=800

# 片段间最大延迟（毫秒）
SEGMENT_DELAY_MAX=3000

# -------------------- 对话历史记录配置（标准多轮格式） --------------------
# 每个会话保留的对话对数量（user + assistant = 1组对话）
# 采用标准的OpenAI对话格式，每组包含一个用户消息和一个助手回复
# 默认20组对话，AI能看到完整的对话结构
# 注意：summary已包含时间信息，不会重复添加时间戳
MAX_CONVERSATION_PAIRS=24

# -------------------- 机器人配置 --------------------
# 机器人名称（用于智能回复判断）
BOT_NAME=失语

# 机器人的其他称呼（用逗号分隔，用于识别是否被提到）
BOT_ALIASES=失语症,小失语

# -------------------- 智能回复判断配置 --------------------
# 是否启用智能回复判断（false则所有消息都回复）
# 启用后，机器人会智能判断群聊消息是否需要回复
# 注意：明确@机器人的消息会强制回复，私聊永远回复
ENABLE_SMART_REPLY=true

# 判断API调用超时（毫秒）
JUDGE_TIMEOUT=20000

# 判断专用模型（独立于回复模型）
# 建议使用便宜快速的模型，如 gpt-4o-mini, gpt-3.5-turbo
JUDGE_MODEL=gpt-4.1-mini

# -------------------- 回复欲望系统配置 --------------------
# 回复欲望阈值（0-1）
# 当欲望值达到此阈值且AI建议回复时，才会实际回复
# 较高的值会降低回复频率，更拟人
REPLY_DESIRE_THRESHOLD=0.62

# 回复欲望衰减率（0-1）
# 每分钟自然衰减的欲望值比例
REPLY_DESIRE_DECAY_RATE=0.08

# 每条消息增加的欲望值（0-1）
# AI判断需要回复时会乘以1.5倍系数
REPLY_DESIRE_BOOST_PER_MESSAGE=0.14

# 最小回复间隔（毫秒）
# 两次回复之间的最小时间间隔，避免回复过于频繁
# 默认10秒，更符合人类行为模式
MIN_REPLY_INTERVAL=10000

# -------------------- 回复队列并发控制 --------------------
# 并发回复数量（1表示一次只能回复1个消息）
# 设置为更大的值可以同时处理多个对话
REPLY_CONCURRENCY=10

# 回复完成后的冷却时间（毫秒）
# 模拟人类思考和打字的间隔，避免回复过于频繁
REPLY_COOLDOWN=2000

# AI生成失败时是否跳过（true更拟人，不会卡住）
# false则会抛出错误并可能影响后续消息处理
SKIP_ON_GENERATION_FAIL=true

# -------------------- Token限制配置 --------------------
# 普通回复最大token数（超过此限制的回复将被跳过）
# 防止AI生成过长的回复，更符合聊天习惯
# 260 tokens ≈ 130-200个汉字
MAX_RESPONSE_TOKENS=260

# -------------------- 消息合并CD配置 --------------------
# 消息合并等待时间（毫秒）
# 用户连续发送消息时，会等待这么长时间看是否还有后续消息
# 所有消息会合并为一条来处理，更符合人类阅读习惯
MESSAGE_MERGE_DELAY=5000

# 是否启用消息合并（true更拟人，会等待用户发完）
# 禁用后每条消息都立即处理
ENABLE_MESSAGE_MERGE=true

# -------------------- 全局历史记录配置 --------------------
# 每个会话保留的全局历史消息数量
# 这些历史会自动添加到system prompt中，让AI了解完整对话
GLOBAL_HISTORY_LIMIT=100

# 是否启用全局历史记录
# 启用后AI能看到整个会话的历史，回复更连贯
ENABLE_GLOBAL_HISTORY=true

# 每个会话保留的工具任务总结数量
# 记录近期的工具调用总结，帮助AI理解之前的操作
TOOL_SUMMARY_LIMIT=15

# 是否启用工具任务历史
# 启用后AI能看到近期工具任务的执行结果
ENABLE_TOOL_SUMMARY=true

# -------------------- 消息队列时效配置 --------------------
# 消息在队列中的最大有效时间（毫秒）
# 超过此时间的消息会被自动过滤，避免回复过时的消息
# 默认5分钟（300000ms）
MESSAGE_MAX_AGE=300000

# -------------------- 路径映射配置（Docker容器环境）--------------------
# 用于将宿主机路径映射到容器内路径，支持AI生成的文件在容器中正确访问
# 格式：宿主机路径->容器路径;宿主机路径2->容器路径2
# 
# 示例（Windows + Docker）:
# PATH_MAPPINGS=F:/bst/sentra-agent/Sentra-Agent-Artifacts->/D/app/Sentra-Agent/artifacts
#
# 示例（多个映射规则）:
# PATH_MAPPINGS=F:/bst/sentra-agent/Sentra-Agent-Artifacts->/D/app/Sentra-Agent/artifacts;E:/data->/mnt/data
#
# 注意事项：
# 1. 使用正斜杠 / 作为路径分隔符（Windows路径会自动转换）
# 2. 多个映射规则用分号 ; 分隔
# 3. 不配置则使用原始路径（本地开发环境）
# 4. 路径匹配不区分大小写
#
PATH_MAPPINGS=

# -------------------- 测试过滤配置 --------------------
# 仅处理特定用户的消息（测试用）
# 设为 0 则处理所有消息
# 设为具体的用户ID则只处理该用户的消息
TEST_USER_ID=0

# 测试模式（启用详细日志）
TEST_MODE=true

# 日志级别
# debug - 最详细，包含所有调试信息
# info - 常规信息
# warn - 警告信息
# error - 仅错误
LOG_LEVEL=debug

# -------------------- 系统提示词配置 --------------------
# 系统提示词文件路径（相对于项目根目录）
# 可以设置为：
#   ./1.txt - 使用根目录的 1.txt
#   ./test/system-prompt.txt - 使用测试专用提示词
SYSTEM_PROMPT_FILE=./1.txt

# -------------------- MCP & Prompts 配置 --------------------
# 是否启用 MCP 工具调用
ENABLE_MCP=true

# 是否启用动态提示词
ENABLE_PROMPTS=true

# -------------------- 阶段提示词配置 --------------------
# 规划阶段提示词
OVERLAY_PLAN=规划需成本优先；若无法直接完成，应先做诊断/信息收集。

# 参数生成阶段提示词
OVERLAY_ARGGEN=严格匹配 schema；仅输出必要字段与最小值集。

# 参数纠错提示词
OVERLAY_ARGGEN_FIX=仅修复缺失/类型错误字段，不引入新键。

# 最终判断提示词
OVERLAY_FINAL_JUDGE=判断严格；不确定则标记失败并说明失败步骤与理由。

# 进度提示词
OVERLAY_SCHEDULE_PROGRESS=生成进度提示时，要体现耐心和关怀，让用户感到被重视。

# 总结提示词
OVERLAY_FINAL_SUMMARY=以3-5条要点总结，并给出可执行的下一步建议。

# ============================================
# 常见配置场景
# ============================================

# --- 场景1: 快速测试（无延迟，总是回复） ---
# SEGMENT_DELAY_MIN=0
# SEGMENT_DELAY_MAX=100
# MULTI_SEGMENT_REPLY_PROBABILITY=1.0
# SINGLE_SEGMENT_REPLY_PROBABILITY=1.0
# GROUP_AT_PROBABILITY=0

# --- 场景2: 真实拟人（随机延迟，随机回复） ---
# SEGMENT_DELAY_MIN=800
# SEGMENT_DELAY_MAX=3000
# MULTI_SEGMENT_REPLY_PROBABILITY=0.6
# SINGLE_SEGMENT_REPLY_PROBABILITY=0.5
# GROUP_AT_PROBABILITY=0.25

# --- 场景3: 调试模式（详细日志，单用户） ---
# TEST_MODE=true
# LOG_LEVEL=debug
# TEST_USER_ID=your-test-user-id

# --- 场景4: 生产环境（所有用户，简洁日志） ---
# TEST_MODE=false
# LOG_LEVEL=info
# TEST_USER_ID=0
