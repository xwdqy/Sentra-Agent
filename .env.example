# 日志级别 - 控制日志输出详细程度
# 日志级别
# type: enum
# options: DEBUG | INFO | WARN | ERROR
LOG_LEVEL=DEBUG

# QQ OneBot 协议服务器地址 - WebSocket 连接主机
# WebSocket 主机
# type: string
WS_HOST=localhost

# QQ OneBot 协议服务器端口 - WebSocket 连接端口
# WebSocket 端口
# type: number
# range: 1024-65535
WS_PORT=6702

# NapCat SDK RPC 调用结果等待超时时间（毫秒）
# RPC 等待超时
# type: number
# range: 1000-900000
SEND_RPC_TIMEOUT_MS=180000

# NapCat SDK RPC 超时重试次数 - 仅网络超时重试，不重试业务失败
# RPC 超时重试次数
# type: number
# range: 0-10
SEND_RPC_MAX_RETRIES=0

# 是否启用 RAG（检索增强）
# type: boolean
# options: true | false
ENABLE_RAG=false

# Napcat 发送图片/文件的 base64 兜底最大大小（MB）当本地 file:// 发送失败时，会尝试 base64:// 兜底
# Base64 兜底大小
# type: number
# range: 0-200
NAPCAT_BASE64_MAX_MB=50

# 单条消息内最多合并发送的媒体段数量（图片）
# 媒体合并发送上限
# type: number
# range: 1-20
SEND_MEDIA_BATCH_MAX=8

# WebSocket 重连间隔（毫秒）
# WebSocket 重连间隔
# type: number
# range: 1000-60000
WS_RECONNECT_INTERVAL_MS=10000

# WebSocket 最大重连次数 - 0 表示无限重连
# WebSocket 最大重连次数
# type: number
# range: 0-999
WS_MAX_RECONNECT_ATTEMPTS=60

# Agent 角色预设文件名称 - 存放在 agent-presets 目录下
# 角色预设文件
# type: string
AGENT_PRESET_FILE=default.txt

# 世界书文件名称 - 存放在 agent-presets/world 目录下
# 世界书文件
# type: string
WORLDBOOK_FILE=world/worldbook.json

# 轻量模型 - 将 .txt/.md 形式的 Agent 预设转换为结构化 JSON 角色卡（留空则使用主模型）
# 角色预设转换模型
# type: string
AGENT_PRESET_CONVERTER_MODEL=

# 角色预设转换 API 地址 - 留空则复用 API_BASE_URL
# 角色预设转换 API
# type: string
AGENT_PRESET_CONVERTER_BASE_URL=

# 角色预设转换 API 密钥 - 留空则复用 API_KEY
# 角色预设转换 API 密钥
# type: string
AGENT_PRESET_CONVERTER_API_KEY=

# 角色预设转换请求超时时间（毫秒）- 仅影响预设转换（txt/md -> 结构化 XML/JSON），留空则复用 TIMEOUT
# 角色预设转换超时
# type: number
# range: 10000-900000
AGENT_PRESET_CONVERTER_TIMEOUT_MS=

# 是否启用教导模式 - 仅白名单用户可通过对话动态修改角色预设
# 启用教导模式
# type: boolean
# options: true | false
AGENT_PRESET_TEACHING_ENABLED=false

# 教导白名单 - 逗号分隔 QQ ID，* 表示所有用户
# 教导白名单
# type: string
AGENT_PRESET_TEACHING_WHITELIST=

# 教导模型 - 留空则复用 MAIN_AI_MODEL
# 教导模型
# type: string
AGENT_PRESET_TEACHING_MODEL=

# 教导 API 地址 - 留空则复用 API_BASE_URL
# 教导 API 地址
# type: string
AGENT_PRESET_TEACHING_BASE_URL=

# 教导 API 密钥 - 留空则复用 API_KEY
# 教导 API 密钥
# type: string
AGENT_PRESET_TEACHING_API_KEY=

# 教导请求超时时间（毫秒）- 仅影响预设教导（让模型生成 edit plan），留空则复用 TIMEOUT
# 教导超时
# type: number
# range: 10000-900000
AGENT_PRESET_TEACHING_TIMEOUT_MS=

# 教导日志文件路径 - 记录所有教导行为
# 教导日志文件
# type: string
AGENT_PRESET_TEACHING_LOG_FILE=./logs/preset-teaching.log

# 教导分析时附加的最近对话对数量 - 每对 = 1 user + 1 assistant
# 教导对话对数量
# type: number
# range: 0-20
AGENT_PRESET_TEACHING_CONTEXT_PAIRS=3

# 教导示例缓存的最大保存条数 - 1 条 = 1 轮 user+assistant 教导示例
# 教导缓存条数
# type: number
# range: 5-100
AGENT_PRESET_TEACHING_CACHE_MAX_EXAMPLES=20

# 每次教导分析时用于 few-shot 上下文的历史示例条数 - 从最近的缓存中选取
# 教导历史示例条数
# type: number
# range: 0-50
AGENT_PRESET_TEACHING_CONTEXT_EXAMPLES=8

# 用途：降低“每次回复都教导”的调用强度，水群/碎片消息会自然跳过
# 教导批处理大小
# type: number
# range: 1-100
# invalid fallback: 1
AGENT_PRESET_TEACHING_BATCH_SIZE=8

# 教导批处理：单个 batch 最大字符数，达到则立即触发 flush；0 表示不限制
# 批处理最大字符数
# type: number
# range: 0-200000
AGENT_PRESET_TEACHING_BATCH_MAX_CHARS=0

# 教导批处理：单个 batch 最大条目数（防止异常情况下无限增长），达到则立即触发 flush
# 批处理最大条目数
# type: number
# range: 1-500
AGENT_PRESET_TEACHING_BATCH_MAX_ITEMS=50

# 教导批处理：最大等待时间（毫秒），达到则立即触发 flush；0 表示仅按条数/字符数触发
# 批处理最大等待时间
# type: number
# range: 0-3600000
AGENT_PRESET_TEACHING_BATCH_TTL_MS=0

# OpenAI 兼容 API 基础地址 - 支持各类兼容服务
# API 基础地址
# type: string
API_BASE_URL=https://yuanplus.chat/v1

# API 密钥 - 用于身份验证
# API 密钥
# type: string
API_KEY=your_api_key_here

# 主要 AI 模型 - 用于所有对话场景
# 主对话模型
# type: string
MAIN_AI_MODEL=gemini-2.5-pro

# Temperature - 控制回复随机性（建议 0.5-0.8）
# Temperature
# type: number
# range: 0.0-2.0
TEMPERATURE=0.7

# 最大 token 数 - -1 表示不限制
# 最大 Tokens
# type: number
# range: -1-128000
MAX_TOKENS=-1

# 最大重试次数 - 网络错误时，>=0；0 表示只尝试 1 次、不做额外重试
# 最大重试次数
# type: number
# range: 0-10
MAX_RETRIES=0

# 请求超时时间（毫秒）
# 请求超时
# type: number
# range: 10000-900000
TIMEOUT=180000

# 主动 Planner 专用模型 - 用于生成主动发言计划
# 主动 Planner 模型
# type: string
PROACTIVE_DIRECTIVE_MODEL=gemini-flash-latest

# 主动 Planner API 地址 - 留空则复用 API_BASE_URL
# 主动 Planner API 地址
# type: string
PROACTIVE_DIRECTIVE_BASE_URL=

# 主动 Planner API 密钥 - 留空则复用 API_KEY
# 主动 Planner API 密钥
# type: string
PROACTIVE_DIRECTIVE_API_KEY=

# 主动 Planner 使用的温度 - 控制生成计划的创造性
# 主动 Planner 温度
# type: number
# range: 0.0-2.0
PROACTIVE_DIRECTIVE_TEMPERATURE=1

# 主动 Planner 最大 token 数 - -1 表示不限制
# 主动 Planner 最大 Tokens
# type: number
# range: -1-32000
PROACTIVE_DIRECTIVE_MAX_TOKENS=-1

# 主动 Planner 超时时间（毫秒）
# 主动 Planner 超时
# type: number
# range: 10000-900000
PROACTIVE_DIRECTIVE_TIMEOUT=180000

# 主动 Planner 重试次数
# 主动 Planner 重试次数
# type: number
# range: 0-5
PROACTIVE_DIRECTIVE_MAX_RETRIES=1

# 群聊白名单：逗号分隔群号（可写 G:123 或 123）
# 主动群白名单
# type: string
PROACTIVE_WHITELIST_GROUPS=

# 私聊白名单：逗号分隔 QQ 号（可写 U:123 或 123）
# 主动私聊白名单
# type: string
PROACTIVE_WHITELIST_USERS=

# 是否记录被白名单拦截的主动候选/出队执行日志
# 记录拦截日志
# type: boolean
# options: true | false
PROACTIVE_LOG_FILTERED=false

# 延迟任务 worker 轮询间隔（毫秒）
# 延迟队列轮询间隔
# type: number
# range: 1000-60000
DELAY_QUEUE_POLL_INTERVAL_MS=10000

# 允许的最大过期时间 - 毫秒，0 表示永不视为"过期丢弃"
# 最大过期时间
# type: number
# range: 0-3600000
DELAY_QUEUE_MAX_LAG_MS=0

# 是否启用 Redis - 用于持久化会话历史和状态
# 启用 Redis
# type: boolean
# options: true | false
REDIS_ENABLED=true

# Redis 主机地址
# Redis 主机
# type: string
REDIS_HOST=127.0.0.1

# Redis 端口
# Redis 端口
# type: number
# range: 1024-65535
REDIS_PORT=6379

# Redis 数据库编号（0-15）
# Redis 数据库
# type: number
# range: 0-15
REDIS_DB=0

# Redis 密码 - 无密码可留空
# Redis 密码
# type: string
REDIS_PASSWORD=

# 私聊会话历史 key 前缀
# 私聊会话前缀
# type: string
REDIS_CONV_PRIVATE_PREFIX=sentra:conv:private:

# 群聊会话历史 key 前缀
# 群聊会话前缀
# type: string
REDIS_CONV_GROUP_PREFIX=sentra:conv:group:

# 会话历史过期时间 - 秒，0 表示不过期
# 会话历史过期时间
# type: number
# range: 0-2592000
REDIS_CONV_TTL_SECONDS=86400

# 单个会话最大保留消息条数 - 0 表示不限制
# 会话最大消息数
# type: number
# range: 0-500
REDIS_CONV_MAX_MESSAGES=0

# 群聊历史 key 前缀
# 群聊历史前缀
# type: string
REDIS_GROUP_HISTORY_PREFIX=sentra:group:

# 群聊历史过期时间 - 秒，0 表示不过期
# 群聊历史过期时间
# type: number
# range: 0-2592000
REDIS_GROUP_HISTORY_TTL_SECONDS=0

# 是否启用主动回复调度器 - 允许 Bot 主动发起对话
# 启用主动回复
# type: boolean
# options: true | false
DESIRE_ENABLED=true

# 主动调度状态 key 前缀 - 用于 Redis
# 主动调度前缀
# type: string
REDIS_DESIRE_PREFIX=sentra:desire:

# 主动调度状态过期时间 - 秒，0 表示不过期
# 主动调度过期时间
# type: number
# range: 0-604800
DESIRE_TTL_SECONDS=86400

# 全局心跳间隔 - 毫秒，用于周期性检查是否需要尝试主动发言
# 主动心跳间隔
# type: number
# range: 10000-300000
DESIRE_TICK_INTERVAL_MS=60000

# 群聊冷场阈值 - 秒，距上次机器人发言多久才允许考虑主动开口
# 群聊冷场阈值
# type: number
# range: 60-3600
DESIRE_GROUP_SILENT_SEC=180

# 私聊冷场阈值（秒）
# 私聊冷场阈值
# type: number
# range: 60-3600
DESIRE_PRIVATE_SILENT_SEC=120

# 群聊最小用户静默时间 - 秒，用作概率曲线的参考尺度，而非硬门槛
# 群聊用户静默时间
# type: number
# range: 60-3600
DESIRE_GROUP_MIN_SINCE_USER_SEC=180

# 私聊最小用户静默时间 - 秒，用作概率曲线的参考尺度，而非硬门槛
# 私聊用户静默时间
# type: number
# range: 60-3600
DESIRE_PRIVATE_MIN_SINCE_USER_SEC=180

# 同一会话每小时最多主动发言次数 - 期望值上限，不是硬性每小时必发
# 每小时主动发言上限
# type: number
# range: 0-10
DESIRE_MAX_PROACTIVE_PER_HOUR=2

# 同一会话每天最多主动发言次数 - 0 表示不限制每日上限，仅按每小时上限控制
# 每日主动发言上限
# type: number
# range: 0-50
DESIRE_MAX_PROACTIVE_PER_DAY=0

# 主动触发强度系数 - >1 更积极，<1 更克制，建议 0.5~2
# 主动触发强度
# type: number
# range: 0.1-5.0
DESIRE_PROACTIVE_INTENSITY=1.0

# 群聊消息过期时间 - 主动回复，超时则不考虑事件
# 群聊消息过期时间
# type: number
# range: 30-600
DESIRE_GROUP_TOPIC_STALE_SEC=120

# 消息频率统计窗口（秒）
# 消息统计窗口
# type: number
# range: 60-600
DESIRE_MSG_WINDOW_SEC=180

# 群聊窗口内最大消息数 - 超过则禁止主动发言
# 群聊窗口最大消息数
# type: number
# range: 5-100
DESIRE_GROUP_MAX_MSG_PER_WINDOW=12

# 私聊窗口内最大消息数
# 私聊窗口最大消息数
# type: number
# range: 5-50
DESIRE_PRIVATE_MAX_MSG_PER_WINDOW=12

# 主动回复活跃时间段开始时刻 - 本地小时 0-23
# 活跃开始时刻
# type: number
# range: 0-23
DESIRE_ACTIVE_HOUR_START=6

# 主动回复活跃时间段结束时刻
# 活跃结束时刻
# type: number
# range: 0-23
DESIRE_ACTIVE_HOUR_END=23

# 同一会话两次主动发言之间的最小间隔 - 秒，硬冷却；0 表示不限制，仅依赖概率和频控
# 主动发言最小间隔
# type: number
# range: 0-3600
DESIRE_MIN_INTERVAL_BETWEEN_PROACTIVE_SEC=300

# 是否启用主动回复的用户疲劳反馈 - 关闭时不会对忽视主动的用户施加概率惩罚
# 启用用户疲劳
# type: boolean
# options: true | false
DESIRE_USER_FATIGUE_ENABLED=true

# 用户疲劳响应窗口 - 若在该窗口内用户没有新消息，则记为一次"未回应 episode"，用于累积 strikes
# 疲劳响应窗口
# type: number
# range: 60-1800
DESIRE_USER_FATIGUE_RESPONSE_WINDOW_SEC=300

# 最大未回应次数 - 连续多少次未在窗口内回应后，进入疲劳惩罚期（至少为 1）
# 最大未回应次数
# type: number
# range: 1-10
DESIRE_USER_FATIGUE_MAX_STRIKES=3

# 疲劳惩罚因子 - 进入疲劳惩罚期后的概率折扣因子（0-1，建议 0.1~0.5；0.2 表示主动概率打 2 折）
# 疲劳惩罚因子
# type: number
# range: 0.1-1.0
DESIRE_USER_FATIGUE_PENALTY_FACTOR=0.2

# 疲劳惩罚持续时间 - 秒，在此期间若仍持续未回应，会延长惩罚结束时间
# 疲劳惩罚持续时间
# type: number
# range: 600-86400
DESIRE_USER_FATIGUE_PENALTY_DURATION_SEC=3600

# 用户疲劳状态过期时间 - 秒，0 表示不过期
# 疲劳状态过期时间
# type: number
# range: 0-604800
DESIRE_USER_FATIGUE_TTL_SECONDS=86400

# 用户疲劳状态 Redis key 前缀
# 疲劳状态前缀
# type: string
REDIS_DESIRE_USER_FATIGUE_PREFIX=sentra:desire:user:

# 是否启用格式修复 - 不合规时自动修复
# 启用格式修复
# type: boolean
# options: true | false
ENABLE_FORMAT_REPAIR=true

# 格式修复使用的模型
# 格式修复模型
# type: string
REPAIR_AI_MODEL=gemini-flash-latest

# 格式修复 API 地址 - 留空则复用 API_BASE_URL
# 格式修复 API 地址
# type: string
REPAIR_BASE_URL=

# 格式修复 API 密钥 - 留空则复用 API_KEY
# 格式修复 API 密钥
# type: string
REPAIR_API_KEY=

# 格式修复请求超时时间（毫秒）- 仅影响修复模型调用（repair_*），留空则复用 TIMEOUT
# 格式修复超时
# type: number
# range: 10000-900000
REPAIR_TIMEOUT_MS=

# Bot 名称列表 - 逗号分隔，用作唤醒关键词和回复概率增强
# Bot 名称
# type: string
BOT_NAMES=失语

# 显式 @ 是否必须回复 - true=一律回复，false=交给模型决定
# @ 必须回复
# type: boolean
# options: true | false
MENTION_MUST_REPLY=false

# 是否启用基于 LLM 的群聊回复决策
# 启用回复决策
# type: boolean
# options: true | false
ENABLE_REPLY_INTERVENTION=true

# 是否使用纯本地群聊回复门禁 - true = 普通群聊主要依赖本地规则；false = 更多群聊消息交给 LLM 做判定
# 纯本地回复门禁
# type: boolean
# options: true | false
PURE_LOCAL_REPLY_GATING=true

# 回复门禁调试模式 - 输出详细判定日志
# 回复门禁调试
# type: boolean
# options: true | false
REPLY_GATE_DEBUG=true

# 群聊回复决策模型
# 回复决策模型
# type: string
REPLY_DECISION_MODEL=grok-beta

# 群聊回复决策 API 地址 - 留空则复用 API_BASE_URL
# 回复决策 API 地址
# type: string
REPLY_DECISION_BASE_URL=

# 群聊回复决策 API 密钥 - 留空则复用 API_KEY
# 回复决策 API 密钥
# type: string
REPLY_DECISION_API_KEY=

# 群聊回复决策最大 token 数 - -1 表示不限制
# 回复决策最大 Tokens
# type: number
# range: -1-8000
REPLY_DECISION_MAX_TOKENS=-1

# 群聊回复决策最大重试次数
# 回复决策最大重试次数
# type: number
# range: 0-5
REPLY_DECISION_MAX_RETRIES=3

# 群聊回复决策超时时间（毫秒）
# 回复决策超时
# type: number
# range: 5000-900000
REPLY_DECISION_TIMEOUT=180000

# 群聊回复决策使用的群历史消息条数
# 群历史消息条数
# type: number
# range: 5-50
REPLY_DECISION_GROUP_RECENT_MESSAGES=15

# 群聊回复决策使用的发送者历史消息条数
# 发送者历史消息条数
# type: number
# range: 2-20
REPLY_DECISION_SENDER_RECENT_MESSAGES=5

# 群聊回复决策使用的机器人最近消息条数（用于判断是否为“紧接着你上一轮发言的追问/跟进”）
# 机器人最近消息条数
# type: number
# range: 0-20
REPLY_DECISION_BOT_RECENT_MESSAGES=4

# 群聊回复决策上下文最大字符数
# 决策上下文最大字符数
# type: number
# range: 50-500
REPLY_DECISION_CONTEXT_MAX_CHARS=120

# LLM 回复决策后的追问窗口 - 秒，在该时间内同一会话（conversationId：群聊=群+用户，私聊=用户）再次发消息会被视为上一轮回复的跟进
# 追问窗口
# 用途：减少群聊里用户连续补一句“哦/嗯/在吗”等引发的重复回复；仅“有意义的跟进”（纠正/补充/新指令）会放宽部分门禁
# type: number
# range: 30-600
REPLY_DECISION_FOLLOWUP_WINDOW_SEC=180

# 是否启用本地 ReplyGate 价值过滤 - false=完全交给 ReplyIntervention
# 启用 ReplyGate
# type: boolean
# options: true | false
REPLY_GATE_ENABLED=true

# 价值过滤累积基线 - 概率低于该值视为噪声，不参与累积（0-1）
# 累积基线
# type: number
# range: 0.0-0.5
REPLY_GATE_ACCUM_BASELINE=0.1

# 价值过滤累积阈值 - 单个会话（conversationId：群聊=群+用户）在有效时间内累积达到该阈值
# 累积阈值
# type: number
# range: 0.3-5.0
REPLY_GATE_ACCUM_THRESHOLD=1.0

# 价值过滤时间半衰期 - 毫秒，越小衰减越快
# 累积半衰期
# type: number
# range: 30000-600000
REPLY_GATE_ACCUM_HALFLIFE_MS=180000

# 是否启用群聊注意力窗口功能 - 限制同时关注的发送者数量
# 启用注意力窗口
# type: boolean
# options: true | false
ATTENTION_WINDOW_ENABLED=true

# 群聊注意力窗口时间（毫秒）
# 注意力窗口时间
# type: number
# range: 30000-600000
ATTENTION_WINDOW_MS=120000

# 群聊注意力窗口最大发送者数量
# 注意力窗口最大发送者数
# type: number
# range: 1-10
ATTENTION_MAX_SENDERS=3

# 是否启用用户疲劳度控制 - 防止对单个用户过度回复
# 启用用户疲劳
# type: boolean
# options: true | false
USER_FATIGUE_ENABLED=true

# 用户疲劳度统计窗口（毫秒）
# 用户疲劳窗口
# type: number
# range: 60000-1800000
USER_REPLY_WINDOW_MS=300000

# 用户基础回复次数限制
# 用户回复基础上限
# type: number
# range: 1-20
USER_REPLY_BASE_LIMIT=5

# 用户最小回复间隔（毫秒）
# 用户最小回复间隔
# type: number
# range: 1000-60000
USER_REPLY_MIN_INTERVAL_MS=10000

# 用户疲劳度回退因子 - 控制回复限制的指数增长速度
# 用户回退因子
# type: number
# range: 1.5-3.0
USER_REPLY_BACKOFF_FACTOR=2

# 用户最大回退倍数
# 用户最大回退倍数
# type: number
# range: 2-16
USER_REPLY_MAX_BACKOFF_MULTIPLIER=8

# 是否启用群组疲劳度控制 - 防止在群内刷屏
# 启用群组疲劳
# type: boolean
# options: true | false
GROUP_FATIGUE_ENABLED=true

# 群组疲劳度统计窗口（毫秒）
# 群组疲劳窗口
# type: number
# range: 60000-1800000
GROUP_REPLY_WINDOW_MS=300000

# 群组基础回复次数限制
# 群组回复基础上限
# type: number
# range: 10-100
GROUP_REPLY_BASE_LIMIT=30

# 群组最小回复间隔（毫秒）
# 群组最小回复间隔
# type: number
# range: 500-30000
GROUP_REPLY_MIN_INTERVAL_MS=2000

# 群组疲劳度回退因子 - 控制回复限制的指数增长速度
# 群组回退因子
# type: number
# range: 1.5-3.0
GROUP_REPLY_BACKOFF_FACTOR=2

# 群组最大回退倍数
# 群组最大回退倍数
# type: number
# range: 2-16
GROUP_REPLY_MAX_BACKOFF_MULTIPLIER=8

# 每个会话的最大并发任务数 - 推荐 1，避免同一群内同一用户触发多个并行回复（conversationId：群聊=群+用户，私聊=用户）
# 会话最大并发任务数
# 最佳实践：按会话串行（per-conversation lock/queue），必要时用队列而不是并行生成，以保证时序与避免“reply-storm”
# type: number
# range: 1-5
MAX_CONCURRENT_PER_SENDER=1

# 排队任务超时时间 - 毫秒，超过则丢弃（按 conversationId 的队列）
# 排队任务超时
# type: number
# range: 10000-120000
QUEUE_TIMEOUT=30000

# 消息聚合窗口 - 毫秒，第一条触发后等待此时间看是否有更多消息（按 conversationId 聚合，避免跨群/跨用户串话）
# 消息聚合窗口
# type: number
# range: 1000-30000
BUNDLE_WINDOW_MS=5000

# 消息聚合最大等待时间（毫秒）（按 conversationId 聚合）
# 聚合最大等待时间
# type: number
# range: 5000-60000
BUNDLE_MAX_MS=15000

# 向量模型名称 - 用于语义聚合
# 聚合向量模型
# type: string
EMBEDDING_MODEL=text-embedding-3-small

# 向量模型 API 密钥 - 留空则复用 API_KEY
# 聚合向量 API 密钥
# type: string
EMBEDDING_API_KEY=

# 向量模型 API 地址 - 留空则复用 API_BASE_URL
# 聚合向量 API 地址
# type: string
EMBEDDING_API_BASE_URL=

# 继续视为同一轮输入的最小语义相似度（0-1）
# 最小语义相似度
# 建议：群聊高并发时适当提高以减少“顺带一句废话”被拼进同一轮导致输出变长；但过高会导致真正补充被拆分进队列
# type: number
# range: 0.3-0.9
BUNDLE_MIN_SIMILARITY=0.6

# 连续低相似度多少次后视为新话题
# 低相似度次数
# type: number
# range: 1-5
BUNDLE_MAX_LOW_SIM_COUNT=2

# 语义聚合向量相似度计算最大超时时间（毫秒）
# 聚合向量计算超时
# type: number
# range: 3000-30000
BUNDLE_EMBEDDING_TIMEOUT_MS=8000

# 语义聚合 Embedding 失败时的最大重试次数
# 聚合向量最大重试次数
# type: number
# range: 0-3
BUNDLE_EMBEDDING_MAX_RETRIES=0

# 群聊多用户合并开关 - 在短时间内将多人的提问合并为一次回复
# 群聊多用户合并
# type: boolean
# options: true | false
GROUP_MULTI_USER_MERGE_ENABLED=true

# 群聊多用户合并窗口 - 毫秒，从第一个触发回复的用户开始计时
# 合并窗口
# type: number
# range: 3000-30000
GROUP_MULTI_USER_MERGE_WINDOW_MS=10000

# 每次合并最多包含的不同用户数量 - 2 表示最多合并两个人的问题一起回复
# 合并最大用户数
# type: number
# range: 2-5
GROUP_MULTI_USER_MERGE_MAX_USERS=2

# 纯文本连续回复优化 - 同一会话连续多少条无工具调用回复时仅保留最新一条（0 表示关闭）
# 纯文本连续回复优化
# type: number
# range: 0-10
PURE_REPLY_SKIP_THRESHOLD=3

# 纯文本连续回复优化冷却时间（毫秒）
# 跳过冷却时间
# type: number
# range: 60000-1800000
PURE_REPLY_SKIP_COOLDOWN_MS=300000

# 是否启用"补充消息单次吞吐"策略 - Judge / ToolResult 阶段
# 补充消息单次吞吐
# type: boolean
# options: true | false
SWALLOW_ON_SUPPLEMENT_ENABLED=true

# "补充消息单次吞吐"在 Judge / ToolResult 阶段的最大静默等待时间（毫秒）
# 最大静默等待时间
# type: number
# range: 0-30000
SWALLOW_ON_SUPPLEMENT_MAX_WAIT_MS=0

# 是否启用发送阶段融合（同一 groupId 短窗口内多条候选回复 -> 让 LLM 压缩融合为 1 条再发送）
# 发送阶段融合
# type: boolean
# options: true | false
SEND_FUSION_ENABLED=true

# 触发融合的最小批次大小（>=2 才有意义）
# 融合最小批次
# type: number
# range: 2-20
SEND_FUSION_MIN_BATCH=2

# 是否启用最近发送去重（跨批次/跨轮，防止短时间内复读；融合后依然有效）
# 最近发送去重
# type: boolean
# options: true | false
SEND_RECENT_FUSION_ENABLED=true

# 最近发送窗口时长（毫秒）
# 最近发送窗口
# type: number
# range: 60000-3600000
SEND_RECENT_FUSION_TTL_MS=600000

# 每个会话最多保留多少条已发送文本参与去重
# 去重最大保留条数
# type: number
# range: 5-50
SEND_RECENT_FUSION_MAX_PER_GROUP=20

# 是否对私聊启用严格语义去重 - true=语义相似度，false=仅文本匹配
# 私聊严格去重
# type: boolean
# options: true | false
SEND_RECENT_FUSION_STRICT_FOR_PRIVATE=true

# 本地语义相似度判定阈值（0-1）：用于最近发送去重与批次内的相似度判断
# 去重最小相似度
# type: number
# range: 0.7-1.0
SEND_FUSION_DEDUP_MIN_SIMILARITY=0.92

# 是否输出本地相似度判定的调试日志
# 去重调试日志
# type: boolean
# options: true | false
SEND_FUSION_DEDUP_LOCAL_DEBUG=false

# 回复发送间隔 - 毫秒，多个任务同时完成时的发送延迟
# 回复发送延迟
# type: number
# range: 500-10000
REPLY_SEND_DELAY_MS=20000

# 是否启用跨会话发送
# 跨会话发送
# type: boolean
# options: true | false
CROSS_CHAT_SEND_ENABLED=true

# 允许跨群发送的目标群列表（逗号分隔）。留空表示“允许所有目标群”（仍受其他门禁限制）。
# 跨群允许列表
# type: string
CROSS_CHAT_SEND_ALLOW_GROUP_IDS=

# 允许跨私聊发送的目标用户列表（逗号分隔）。留空表示“允许所有目标用户”（仍受其他门禁限制）。
# 跨私聊允许列表
# type: string
CROSS_CHAT_SEND_ALLOW_USER_IDS=

# 允许发起跨会话指令的用户列表（逗号分隔）。留空表示“所有人都可发起”（不推荐；建议至少填写管理员）。
# 跨会话发起人白名单
# type: string
CROSS_CHAT_SEND_ALLOW_SENDER_IDS=

# 安全门禁：要求目标 numeric ID 必须出现在用户消息文本/摘要里（防止模型编造目标）。
# 目标必须出现在用户文本
# type: boolean
# options: true | false
CROSS_CHAT_SEND_REQUIRE_TARGET_IN_USER_TEXT=false

# 单次允许的跨会话发送操作次数上限（防刷屏）。
# 跨会话操作次数上限
# type: number
# range: 1-50
CROSS_CHAT_SEND_MAX_OPS_PER_RESPONSE=6

# 是否启用社交上下文注入
# 社交上下文注入
# type: boolean
# options: true | false
SOCIAL_CONTEXT_ENABLED=true

# 缓存有效期（毫秒）。在 TTL 内优先读磁盘缓存/内存缓存，避免频繁 RPC。
# 社交上下文缓存 TTL
# type: number
# range: 0-86400000
SOCIAL_CONTEXT_TTL_MS=1800000

# 群列表最多注入多少条（防止提示词过长）
# 最大注入群数量
# type: number
# range: 0-5000
SOCIAL_CONTEXT_MAX_GROUPS=200

# 好友列表最多注入多少条（防止提示词过长）
# 最大注入好友数量
# type: number
# range: 0-5000
SOCIAL_CONTEXT_MAX_FRIENDS=200

# 每个群最多保存的对话对数量 - 1 对 = 1 user + 1 assistant
# 最大对话对数量
# type: number
# range: 5-100
MAX_CONVERSATION_PAIRS=20

# MCP 上下文中每个群最多使用的历史对话对数量 - 不设置则等于 MAX_CONVERSATION_PAIRS
# MCP 最大上下文对话对数量
# type: number
# range: 5-100
MCP_MAX_CONTEXT_PAIRS=20

# MCP 上下文中“历史对话内容”的最大 token 预算（仅裁剪 history，不影响当前 user_question/pending/persona/memory 等块），0 表示不限制
# MCP 历史上下文 token 上限
# type: number
# range: 0-1000000
MCP_MAX_CONTEXT_TOKENS=64000

# 是否将“是否需要工具/是否直接回复”的决策完全托管给 MCP（sentra-mcp）
# 开启后：主程序不会运行 ToolRouter，不会直接 reply 跳过 MCP；每轮都会进入 MCP 的 judge/plan/execute
# type: boolean
# options: true | false
MCP_DELEGATE_TOOL_DECISION=true

# 当判定需要走工具/外部信息流程且耗时较长时，是否先向用户发送一段“承上启下”的短回复
# 启用工具预回复
# type: boolean
# options: true | false
ENABLE_TOOL_PREREPLY=true

# 工具预回复生成的超时时间（毫秒）- 超时/失败则跳过预回复，不影响后续流程
# 工具预回复超时
# type: number
# range: 500-900000
TOOL_PREREPLY_TIMEOUT_MS=90000

# 工具预回复发送等待窗口（毫秒）
# 预回复时间
# type: number
# range: 0-600000
TOOL_PREREPLY_WAIT_TOOL_RESULT_MS=42000

# 工具预回复冷却时间（毫秒）同一 sender 在冷却时间内不会重复发送预回复；若本次工具调用数量 > 3，则忽略冷却规则
# 预回复冷却
# type: number
# range: 0-3600000
TOOL_PREREPLY_COOLDOWN_MS=60000

# 是否启用旧对话自动摘要与长期记忆
# 启用对话摘要
# type: boolean
# options: true | false
CONTEXT_MEMORY_ENABLED=true

# 用于摘要的模型 - 留空则复用 MAIN_AI_MODEL
# 摘要模型
# type: string
CONTEXT_MEMORY_MODEL=

# 摘要 API 地址 - 留空则复用 API_BASE_URL
# 摘要 API 地址
# type: string
CONTEXT_MEMORY_BASE_URL=

# 摘要 API 密钥 - 留空则复用 API_KEY
# 摘要 API 密钥
# type: string
CONTEXT_MEMORY_API_KEY=

# 摘要请求超时时间（毫秒）- 仅影响长期记忆摘要（compressContext），留空则复用 TIMEOUT
# 摘要超时
# type: number
# range: 10000-900000
CONTEXT_MEMORY_TIMEOUT_MS=

# 被丢弃的对话对累计达到多少组时触发一次摘要 - 0=自动取 MCP_MAX_CONTEXT_PAIRS / 2
# 摘要触发丢弃对话对数
# type: number
# range: 0-50
CONTEXT_MEMORY_TRIGGER_DISCARDED_PAIRS=0

# 上下文摘要 Redis key 前缀
# 摘要 Redis 前缀
# type: string
REDIS_CONTEXT_MEMORY_PREFIX=sentra:memory:

# 摘要过期时间 - 秒，0 表示不过期
# 摘要过期时间
# type: number
# range: 0-2592000
REDIS_CONTEXT_MEMORY_TTL_SECONDS=0

# 摘要时间范围描述使用的时区
# 摘要时区
# type: string
# options: Asia/Shanghai | UTC | America/New_York
CONTEXT_MEMORY_TIMEZONE=Asia/Shanghai

# 最大重试次数 - 格式验证失败或 Token 超限时
# 最大响应重试次数
# type: number
# range: 0-10
MAX_RESPONSE_RETRIES=1

# 响应文本 token 上限 - 只统计 <text*> 段，0 或 -1 表示不限制
# 响应文本 Tokens 上限
# type: number
# range: -1-2000
MAX_RESPONSE_TOKENS=650

# 是否启用严格格式验证
# 严格格式验证
# type: boolean
# options: true | false
ENABLE_STRICT_FORMAT_CHECK=true

# Sentra-Emo 服务地址
# Sentra-Emo 地址
# type: string
SENTRA_EMO_URL=http://localhost:7200

# 是否启用 Sentra-Emo 情绪模块（总开关）
# Sentra-Emo 启用开关
# type: boolean
# options: true | false
SENTRA_EMO_ENABLED=false

# Sentra-Emo 请求超时时间（毫秒）
# Sentra-Emo 超时
# type: number
# range: 10000-900000
SENTRA_EMO_TIMEOUT=180000

# Sentra-Emo 本地情绪门禁：最小文本长度 - 字符，短于该长度的消息不会触发情绪分析
# 情绪分析最小长度
# type: number
# range: 1-20
EMO_ANALYZE_MIN_LEN=3

# Sentra-Emo 本地情绪门禁：AFINN 情绪绝对分数阈值 - 基于 sentiment-zh_cn_web，建议范围 3-5
# 情绪分数阈值
# type: number
# range: 1-10
EMO_ANALYZE_MIN_ABS_SCORE=4

# Sentra-Emo 本地情绪门禁：同一用户两次情绪分析之间的最小间隔 - 毫秒，用于节流、降低 QPS
# 情绪分析最小间隔
# type: number
# range: 1000-60000
EMO_ANALYZE_MIN_INTERVAL_MS=10000

# 是否启用用户画像功能 - 动态构建用户性格、兴趣等特征
# 启用用户画像
# type: boolean
# options: true | false
ENABLE_USER_PERSONA=true

# 画像更新时间间隔 - 毫秒，防止频繁调用 LLM
# 画像更新时间间隔
# type: number
# range: 60000-3600000
PERSONA_UPDATE_INTERVAL_MS=600000

# 画像更新消息阈值 - 距上次更新至少需要积累的新消息数
# 画像更新消息阈值
# type: number
# range: 10-100
PERSONA_MIN_MESSAGES=30

# 用户数据存储目录 - 相对于项目根目录
# 用户数据目录
# type: string
PERSONA_DATA_DIR=./userData

# 画像分析使用的模型
# 画像模型
# type: string
PERSONA_MODEL=grok-4.1-fast

# 画像分析 API 地址 - 留空则复用 API_BASE_URL
# 画像 API 地址
# type: string
PERSONA_BASE_URL=

# 画像分析 API 密钥 - 留空则复用 API_KEY
# 画像 API 密钥
# type: string
PERSONA_API_KEY=

# 画像分析请求超时时间（毫秒）- 仅影响用户画像分析（persona_initial/refine），留空则复用 TIMEOUT
# 画像超时
# type: number
# range: 10000-900000
PERSONA_TIMEOUT_MS=

# 最大历史消息保留数
# 最大历史消息数
# type: number
# range: 50-500
PERSONA_MAX_HISTORY=100

# 最近消息分析窗口 - 条数，用于画像更新时的证据采样
# 最近消息窗口
# type: number
# range: 20-100
PERSONA_RECENT_MESSAGES=40

# 画像元素半衰期 - 毫秒，控制旧特征随时间衰减速度
# 画像半衰期
# type: number
# range: 86400000-604800000
PERSONA_HALFLIFE_MS=172800000

# 性格特征最大数量
# 最大性格特征数
# type: number
# range: 3-15
PERSONA_MAX_TRAITS=6

# 兴趣领域最大数量
# 最大兴趣领域数
# type: number
# range: 5-20
PERSONA_MAX_INTERESTS=8

# 行为模式最大数量
# 最大行为模式数
# type: number
# range: 3-15
PERSONA_MAX_PATTERNS=6

# 关键洞察最大数量
# 最大关键洞察数
# type: number
# range: 3-15
PERSONA_MAX_INSIGHTS=6

# 是否跳过 NapCat 自动安装提示 - 已手动安装时设为 true
# 跳过 NapCat 安装提示
# type: boolean
# options: true | false
SENTRA_SKIP_NAPCAT_INSTALL=false

# NapCat 安装文件存放目录 - 默认写到项目同级 napcat-installer
# NapCat 安装目录
# type: string
NAPCAT_INSTALL_DIR=..

# NapCat Linux Shell 安装脚本下载地址 - 留空则使用官方镜像
# NapCat 安装脚本地址
# type: string
NAPCAT_INSTALLER_URL=